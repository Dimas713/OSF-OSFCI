# (c) Hewlett Packard Enterprise LP - 2020
#!/bin/bash

function check_requirements() {
	for i in jq openssl base64 curl
	do
		command=`which $i`
		if [ "$command" == "" ]
		then
			echo "Error: Please install $i or verify it is accessible through your default execution path variable"
			exit 1
		fi
	done
}

function help() {
   echo "release_ci is a command line tool use to close a CI session:
   echo ""
   echo "Mandatory options are:"
   echo "-s or --server <servername> : OSFCI server name returned by session opening"
   exit 0
}

check_requirements

reuse="0"
keep="0"
waitServer="0"

while [[ $# -gt 0 ]]
do
key="$1"

case $key in
    -s|--server)
    serverName="$2"
    shift # past argument
    shift # past value
    ;;
    *)    # unknown option
    shift # past argument
    help
    exit 1
    ;;
esac
done

# We have to release the session
# We do not need to stop the power as this script doesn't turn it on
curl -v -o $TMPDIR/test.txt -b $HOME/.osfci_cookies/$username.jar -X GET "https://osfci.tech/ci/stopServer/$serverName"
rm $TMPDIR/test.txt
rm $HOME/.osfci_cookies/*
